var app=angular.module("dofitarioApp",["ui.router"]);app.config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("app",{url:"/app",templateUrl:"app/home.html"}),e.state("roster",{url:"/app/roster",templateUrl:"app/roster.html"}),e.state("clases",{url:"/app/clases",templateUrl:"app/clases.html"}),e.state("todo",{url:"/app/todo",templateUrl:"app/todo.html"}),e.state("info",{url:"/app/info",templateUrl:"app/info.html"}),e.state("recursos",{url:"/app/recursos",templateUrl:"app/recursos.html"}),e.state("dofitario",{url:"/app/dofitario",templateUrl:"app/dofitario.html"}),e.state("403",{url:"/403",template:"<h1>Not authorized</h1>"}),t.when("","/app")}]),angular.module("dofitarioApp").controller("MainCtrl",["$scope","$http","ApiFactory","$state",function(e,t,r,o){function a(){n.slots=l,n.generateUserList(),n.loadGenTable()}var n=this,l=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];n.generateUserList=function(){console.log("Generando lista"),r.getUserList().then(function(e){"Error"===e.data.response||(console.log(e),n.userList=e.data.users)})},n.loadTable=function(e){console.log(e),r.getTimetable(e).then(function(e){"Error"===e.data.response||(console.log(e),n.slots=e.data.week)})},n.deleteUser=function(e){console.log(r),r.deleteOne(e).then(function(e){"Error"===e.data.response||(console.log(e),n.generateUserList(),n.loadGenTable(),n.user="")})},n.saveTable=function(e,t){t=t||l,console.log(r),r.putTimetable(e,t).then(function(e){"Error"===e.data.response||(console.log(e),n.newUser="",n.generateUserList(),n.loadGenTable())})},n.resetTable=function(e){console.log(r),r.putTimetable(e,l).then(function(t){"Error"===t.data.response||(console.log(t),n.newUser="",n.slots=l,n.loadTable(e),n.loadGenTable())})},n.loadGenTable=function(){console.log(r),r.getGenTimetable().then(function(e){"Error"===e.data.response||(console.log(e),n.slots2=e.data.week)})},a()}]),angular.module("dofitarioApp").directive("genTimetable",function(){return{restrict:"A",templateUrl:"gen-timetable.tpl.html",scope:{slots:"="},link:function(e,t,r){function o(e,t,r){for(var o=[],a=e;a<=t;a+=r)o.push(a);return o}function a(){e.loop=o,e.days=n}var n=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];e.getColor=function(e){return e>=1&&e<3?"range1":e>=3&&e<5?"range2":e>=5&&e<7?"range3":e>=7&&e<9?"range4":e>=9?"range5":""},e.greaterThan=function(e){return e+=12,e>=24?e-24:e},a()}}}),angular.module("dofitarioApp").directive("myTimetable",function(){return{restrict:"A",templateUrl:"my-timetable.tpl.html",scope:{slots:"="},link:function(e,t,r){function o(e,t,r){for(var o=[],a=e;a<=t;a+=r)o.push(a);return o}function a(t,r,o){var a=0;switch(t){case"day":for(i.day[r]=i.day[r]?0:1,a=0;a<=16;a++)e.slots[r][a]=i.day[r];break;case"hour":for(i.hour[o]=i.hour[o]?0:1,a=0;a<7;a++)e.slots[a][o]=i.hour[o];break;case"slot":i.state&&(e.slots[r][o]=e.slots[r][o]?0:1)}}function n(e,t,r){i.state=e,i.state&&a("slot",t,r)}function l(){e.loop=o,e.toggle=a,e.select=n,e.days=s}var s=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],i={state:!1,day:[0,0,0,0,0,0,0],hour:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};e.greaterThan=function(e){return e+=12,e>=24?e-24:e},l()}}}),angular.module("dofitarioApp").directive("ngEnter",function(){return function(e,t,r){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(r.ngEnter,{event:t})}),t.preventDefault())})}}),angular.module("dofitarioApp").factory("ApiFactory",["$http",function(e){function t(t){return e.get(l+"api/users/"+t+"/week")}function r(t){return e.delete(l+"api/users/"+t+"/week")}function o(){return e.get(l+"api/general/week")}function a(){return e.get(l+"api/general/userlist")}function n(t,r){return e.put(l+"api/users/"+t+"/week",{nick:t,week:r})}var l="http://0.0.0.0:9999/";return{getTimetable:t,getGenTimetable:o,putTimetable:n,getUserList:a,deleteOne:r}}]);