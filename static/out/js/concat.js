var app=angular.module("dofitarioApp",["ui.router"]);app.config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("app",{url:"/app",templateUrl:"app/home.html"}),e.state("roster",{url:"/app/roster",templateUrl:"app/roster.html"}),e.state("clases",{url:"/app/clases",templateUrl:"app/clases.html"}),e.state("todo",{url:"/app/todo",templateUrl:"app/todo.html"}),e.state("info",{url:"/app/info",templateUrl:"app/info.html"}),e.state("recursos",{url:"/app/recursos",templateUrl:"app/recursos.html"}),e.state("dofitario",{url:"/app/dofitario",templateUrl:"app/dofitario.html"}),e.state("403",{url:"/403",template:"<h1>Not authorized</h1>"}),t.when("","/app")}]),angular.module("dofitarioApp").controller("MainCtrl",["$scope","$http","ApiFactory","$state",function(e,t,a,n){function r(){o.userList=[],o.slots=s,o.slots2=s,o.user="",o.newUser="",o.generateUserList(),o.loadGenTable()}var o=this,s=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];o.generateUserList=function(e){console.log("Generando lista"),a.getUserList().then(function(t){o.userList=t.data.users,o.user=e?e:o.userList[0],o.user?o.loadTable(o.user):o.slots=s})},o.loadTable=function(e){a.getTimetable(e).then(function(e){o.slots=e.data.week}).catch(function(e){})},o.deleteUser=function(e){a.deleteOne(e).then(function(e){o.generateUserList(),o.loadGenTable(),o.user=o.userList[0]}).catch(function(e){})},o.saveTable=function(e,t){t=t||s,a.putTimetable(e,t).then(function(e){console.log(e),o.newUser="",o.generateUserList(o.user),o.loadGenTable()}).catch(function(e){console.log(e),alert(e.data.message)})},o.createUser=function(){a.createNewUser(o.newUser).then(function(e){var t=e.data;o.newUser="",o.loadTable(t.nick),o.generateUserList(t.nick),o.loadGenTable()}).catch(function(e){console.log(e),alert(e.data.message)})},o.resetTable=function(e){a.putTimetable(e,s).then(function(e){o.slots=e.data.week,o.newUser="",o.generateUserList(o.user),o.loadGenTable()}).catch(function(e){alert(e.data.message)})},o.loadGenTable=function(){console.log(a),a.getGenTimetable().then(function(e){o.slots2=e.data.week}).catch(function(e){console.log(e.data.message),o.slots2=s})},r()}]),angular.module("dofitarioApp").directive("genTimetable",function(){return{restrict:"A",templateUrl:"gen-timetable.tpl.html",scope:{slots:"="},link:function(e,t,a){function n(e,t,a){for(var n=[],r=e;r<=t;r+=a)n.push(r);return n}function r(){e.loop=n,e.days=o}var o=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];e.getColor=function(e){return e>=1&&e<3?"range1":e>=3&&e<5?"range2":e>=5&&e<7?"range3":e>=7&&e<9?"range4":e>=9?"range5":""},e.greaterThan=function(e){return e+=12,e>=24?e-24:e},r()}}}),angular.module("dofitarioApp").directive("myTimetable",function(){return{restrict:"A",templateUrl:"my-timetable.tpl.html",scope:{slots:"="},link:function(e,t,a){function n(e,t,a){for(var n=[],r=e;r<=t;r+=a)n.push(r);return n}function r(t,a,n){var r=0;switch(t){case"day":for(i.day[a]=i.day[a]?0:1,r=0;r<=16;r++)e.slots[a][r]=i.day[a];break;case"hour":for(i.hour[n]=i.hour[n]?0:1,r=0;r<7;r++)e.slots[r][n]=i.hour[n];break;case"slot":i.state&&(e.slots[a][n]=e.slots[a][n]?0:1)}}function o(e,t,a){i.state=e,i.state&&r("slot",t,a)}function s(){e.loop=n,e.toggle=r,e.select=o,e.days=l}var l=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],i={state:!1,day:[0,0,0,0,0,0,0],hour:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};e.greaterThan=function(e){return e+=12,e>=24?e-24:e},s()}}}),angular.module("dofitarioApp").directive("ngEnter",function(){return function(e,t,a){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(a.ngEnter,{event:t})}),t.preventDefault())})}}),angular.module("dofitarioApp").factory("ApiFactory",["$http",function(e){function t(t){return e.get(l+"api/users/"+t+"/week")}function a(t){return e.delete(l+"api/users/"+t)}function n(){return e.get(l+"api/general/week")}function r(){return e.get(l+"api/users")}function o(t){return console.log(t),e.post(l+"api/users",{nick:t})}function s(t,a){return e.put(l+"api/users/"+t+"/week",{nick:t,week:a})}var l="http://www.dofitos.tk/";return{getTimetable:t,getGenTimetable:n,putTimetable:s,getUserList:r,deleteOne:a,createNewUser:o}}]);